<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>How to  deploy a Kubernetes cluster on RHEL 7.5 flavour of LinuxONE instances?</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>How to  deploy a Kubernetes cluster on RHEL 7.5 flavour of LinuxONE instances?</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For this documentation two LinuxONE instances has been used for deployment and testing pupose. One can extend it to any number of worker nodes.
Out of these two instances one acts as master and other acts as a worker. Create two instances on LinuxONE community cloud and ssh using the respective keys.</p>
</div>
<div class="paragraph">
<p>A kubernetes cluster consists of these essential components</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1. Etcd (distributed key-value storage)
2. Server
3. Scheduler
4. Controller manager
5. Kubectl (command line client for kubernetes)
5. Docker (container)
6. Kubelet
7. Kube-proxy
8. Flannel</pre>
</div>
</div>
<div class="paragraph">
<p>The following components have been used.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 30%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL 7.5 flavour of L1CC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ETCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2.22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker CE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.05</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flannel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.10.0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All the commands have been run as root user. There may permission issues at some points. So it is better if we login as root user from the start itself.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also copy the worker node keys to the master node because you will need them to transfer certificates and config files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scp -i master.pem &lt;PATH_OF_WORKER_NODES&gt;/{worker1.pem,worker2.pem} root@148.100.98.174:/root</pre>
</div>
</div>
<div class="paragraph">
<p>After you ssh into your instance check the rhel version using the below command and wait for some time. Now  rerun the same command, the rhel version gets updated.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat /etc/os-release</pre>
</div>
</div>
<div class="paragraph">
<p>To be able to download packages you need to register your instance and for that you need a RHEL account. Also enable the repos from which you can download
the kubernetes components.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>subscription-manager register
subscription-manager attach
subscription-manager repos --enable=rhel-7-for-system-z-extras-rpms
subscription-manager repos --list-enabled</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binaries">Binaries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set the following variables on both the nodes</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TAG=v1.9.8
URL=https://storage.googleapis.com/kubernetes-release/release/$TAG/bin/linux/s390x</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Binaries to be installed on Master Node</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -# -L -o /usr/bin/kube-apiserver $URL/kube-apiserver
curl -# -L -o /usr/bin/kube-controller-manager $URL/kube-controller-manager
curl -# -L -o /usr/bin/kube-scheduler $URL/kube-scheduler
curl -# -L -o /usr/bin/kubectl $URL/kubectl</pre>
</div>
</div>
<div class="paragraph">
<p>Make them executable</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x /usr/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Binaries to be installed on Worker Node</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -# -L -o /usr/bin/kube-proxy $URL/kube-proxy
curl -# -L -o /usr/bin/kubelet $URL/kubelet</pre>
</div>
</div>
<div class="paragraph">
<p>Make them executable</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x /usr/bin/{kubelet,kube-proxy}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Swap space</strong></p>
</div>
<div class="paragraph">
<p>The swap space on all kubernetes master and nodes should be disabled. If swap is
not disabled, kubelet service will not start on the master and nodes.
This is done to tightly pack instances. All deployments should be pinned with
CPU/memory limits. So if the scheduler sends a pod to a machine it should never
use swap space at all. Swap space slows down things. Its mainly done
for improving  performance.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>swapoff -a</pre>
</div>
</div>
<div class="paragraph">
<p>Also,  comment the entries related to swap space in  /etc/fstab file so that
after a reboot also the swap space remains disabled. You can open the file and
comment the swap related lines or use the below command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab</pre>
</div>
</div>
<div class="paragraph">
<p>By default selinux and firewalld are disabled. You can check them using this</p>
</div>
<div class="paragraph">
<p><strong>Selinux</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat /etc/selinux/config</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Firewalld</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl status firewalld</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_folders">Folders</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Make folders on master node</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p /srv/kubernetes
mkdir -p /var/lib/flanneld
mkdir -p /var/lib/{kube-scheduler,kube-controller-manager}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Make folders on worker node or nodes</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p /srv/kubernetes
mkdir -p /var/lib/flanneld
mkdir -p /var/lib/{kubelet}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this documnetation whereever 148.100.98.173 has been used you should use your master ip there and inplace of 148.100.98.174 use your worker ip.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_certificates">Certificates</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>cd /srv/kubernetes
openssl genrsa -out ca-key.pem 2048
openssl req -x509 -new -nodes -key ca-key.pem -days 7200 -out ca.pem -subj "/CN=kube-ca"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Openssl Config for generating certificates for master node</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; openssl.cnf &lt;&lt;EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name

[req_distinguished_name]

[v3_req]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = kubernetes
DNS.2 = kubernetes.default
DNS.3 = kubernetes.default.svc
DNS.4 = kubernetes.default.svc.cluster.local
IP.1 = 127.0.0.1
IP.2 = 148.100.98.173
IP.3 = 100.65.0.1 #Service IP
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Kube-apiserver certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out apiserver-key.pem 2048
openssl req -new -key apiserver-key.pem -out apiserver.csr -subj "/CN=kube-apiserver" -config openssl.cnf
openssl x509 -req -in apiserver.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out apiserver.pem -days 7200 -extensions v3_req -extfile openssl.cnf</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Kube-controller certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-controller-manager-key.pem 2048
openssl req -new -key kube-controller-manager-key.pem -out kube-controller-manager.csr -subj "/CN=kube-controller-manager"
openssl x509 -req -in kube-controller-manager.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-controller-manager.pem -days 7200</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Kube-scheduler certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-scheduler-key.pem 2048
openssl req -new -key kube-scheduler-key.pem -out kube-scheduler.csr -subj "/CN=kube-scheduler"
openssl x509 -req -in kube-scheduler.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-scheduler.pem -days 7200</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Admin certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out admin-key.pem 2048
openssl req -new -key admin-key.pem -out admin.csr -subj "/CN=admin"
openssl x509 -req -in admin.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out admin.pem -days 7200</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Openssl Config for generating certificates for worker node</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; worker_openssl.cnf &lt;&lt; EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[v3_req]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
IP.1 = 148.100.98.174
EOF</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you have more than one worker node then add their ip addressess in the below configuration file as IP.2= , IP.3= &#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Kubelet certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kubelet-key.pem 2048
openssl req -new -key kubelet-key.pem -out kubelet.csr -subj "/CN=kubelet" -config worker_openssl.cnf
openssl x509 -req -in kubelet.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kubelet.pem -days 7200 -extensions v3_req -extfile worker_openssl.cnf</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Kube-proxy certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-proxy-key.pem 2048
openssl req -new -key kube-proxy-key.pem -out kube-proxy.csr -subj "/CN=kube-proxy"
openssl x509 -req -in kube-proxy.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-proxy.pem -days 7200</pre>
</div>
</div>
<div class="paragraph">
<p>Before you generate the worker certificates do note that kubeworker.novalocal is the hostname of my worker machine. So do change it according to your worker node&#8217;s hostname.</p>
</div>
<div class="paragraph">
<p><strong>Worker certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kubeworker.novalocal-worker-key.pem 2048
WORKER_IP=148.100.98.174 openssl req -new -key kubeworker.novalocal-worker-key.pem -out kubeworker.novalocal-worker.csr -subj "/CN=system:node:kubeworker.novalocal" -config worker_openssl.cnf
WORKER_IP=148.100.98.174 openssl x509 -req -in kubeworker.novalocal-worker.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kubeworker.novalocal-worker.pem -days 7200 -extensions v3_req -extfile worker_openssl.cnf</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Config file for generating etcd peer certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; etcd_openssl.cnf &lt;&lt;EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth,serverAuth
subjectAltName = @alt_names
[alt_names]
IP.1 = 148.100.98.173
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Etcd certificates</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out etcd.key 2048
openssl req -new -key etcd.key -out etcd.csr -subj "/CN=etcd" -extensions v3_req -config etcd_openssl.cnf -sha256
openssl x509 -req -sha256 -CA ca.pem -CAkey ca-key.pem -CAcreateserial -in etcd.csr -out etcd.crt -extensions v3_req -extfile etcd_openssl.cnf -days 7200</pre>
</div>
</div>
<div class="paragraph">
<p>Copy the required keys to the worker node/nodes</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scp -i &lt;path_where_your_worker_keys_are&gt; /srv/kubernetes/{ca.pem,etcd.crt,etcd.key,kubelet.pem,kubelet-key.pem} root@148.100.98.174:/srv/kubernetes/</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuation_files">Configuation files</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Kubeconfig files for various components</strong></p>
</div>
<div class="paragraph">
<p><strong>admin kubeconfig</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.98.173:6443
kubectl config set-credentials admin --client-certificate=/srv/kubernetes/admin.pem --client-key=/srv/kubernetes/admin-key.pem --embed-certs=true --token=$TOKEN
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=admin
kubectl config use-context linux1.k8s
cat ~/.kube/config</pre>
</div>
</div>
<div class="paragraph">
<p><strong>kube-controller-manager kubeconfig</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.98.173:6443 --kubeconfig=/var/lib/kube-controller-manager/kubeconfig
kubectl config set-credentials kube-controller-manager --client-certificate=/srv/kubernetes/kube-controller-manager.pem --client-key=/srv/kubernetes/kube-controller-manager-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/var/lib/kube-controller-manager/kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=kube-controller-manager --kubeconfig=/var/lib/kube-controller-manager/kubeconfig; kubectl config use-context linux1.k8s --kubeconfig=/var/lib/kube-controller-manager/kubeconfig</pre>
</div>
</div>
<div class="paragraph">
<p><strong>kube-scheduler kubeconfig</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.98.173:6443 --kubeconfig=/var/lib/kube-scheduler/kubeconfig
kubectl config set-credentials kube-scheduler --client-certificate=/srv/kubernetes/kube-scheduler.pem --client-key=/srv/kubernetes/kube-scheduler-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/var/lib/kube-scheduler/kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=kube-scheduler --kubeconfig=/var/lib/kube-scheduler/kubeconfig; kubectl config use-context linux1.k8s --kubeconfig=/var/lib/kube-scheduler/kubeconfig</pre>
</div>
</div>
<div class="paragraph">
<p><strong>kubelet kubeconfig</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.98.173:6443 --kubeconfig=/srv/kubernetes/kubeworker.novalocal-worker.kubeconfig
kubectl config set-credentials kubeworker.novalocal --client-certificate=/srv/kubernetes/kubeworker.novalocal-worker.pem --client-key=/srv/kubernetes/kubeworker.novalocal-worker-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/srv/kubernetes/kubeworker.novalocal-worker.kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=kubeworker.novalocal --kubeconfig=/srv/kubernetes/kubeworker.novalocal-worker.kubeconfig
kubectl config use-context linux1.k8s --kubeconfig=/srv/kubernetes/kubeworker.novalocal-worker.kubeconfig</pre>
</div>
</div>
<div class="paragraph">
<p>Copy the required config files to the worker node/nodes</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scp -i &lt;path_where_your_worker_keys_are&gt; kubeworker.novalocal-worker.kubeconfig root@148.100.98.174:/var/lib/kubelet/kubelet.kubeconfig</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_etcd">Etcd</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>About etcd</strong></p>
</div>
<div class="paragraph">
<p>It is a distributed storage device used to store the state of the cluster. All other components are stateless. A state is stored in the
form of key-value pair.</p>
</div>
<div class="paragraph">
<p>Package Installation</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum install etcd</pre>
</div>
</div>
<div class="paragraph">
<p>Modify the service file in the /usr/lib/systemd/system/etcd.service so that it should look like this after the modifications</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
Environment="ETCD_UNSUPPORTED_ARCH=S390X"
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
User=etcd
# set GOMAXPROCS to number of processors

ExecStart=/bin/bash -c "GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\"${ETCD_NAME}\"  \
--data-dir=\"${ETCD_DATA_DIR}\" \
--listen-client-urls=\"${ETCD_LISTEN_CLIENT_URLS}\" \
--cert-file=\"${ETCD_CERT_FILE}\" \
--key-file=\"${ETCD_KEY_FILE}\" \
--peer-cert-file=\"${ETCD_PEER_CERT_FILE}\" \
--peer-key-file=\"${ETCD_PEER_KEY_FILE}\" \
--trusted-ca-file=\"${ETCD_TRUSTED_CA_FILE}\"  \
--peer-trusted-ca-file=\"${ETCD_TRUSTED_CA_FILE}\"  \
--peer-client-cert-auth \
--client-cert-auth \
--initial-advertise-peer-urls=\"${ETCD_INITIAL_ADVERTISE_PEER_URLS}\"  \
--listen-peer-urls=\"${ETCD_LISTEN_PEER_URLS}\" \
--advertise-client-urls=\"${ETCD_ADVERTISE_CLIENT_URLS}\"  \
--initial-cluster-token=\"${ETCD_INITIAL_CLUSTER_TOKEN}\" \
--initial-cluster=\"${ETCD_INITIAL_CLUSTER}\" \
--initial-cluster-state=\"${ETCD_INITIAL_CLUSTER_STATE}\""

Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="paragraph">
<p>Modify the configuration file in the <strong>/etc/etcd/etcd.conf</strong> and it should look like this after all the modifications. But do note to change the ip address.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#[Member]
#ETCD_CORS=""
ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
#ETCD_WAL_DIR=""
ETCD_LISTEN_PEER_URLS="https://148.100.98.173:2380"
ETCD_LISTEN_CLIENT_URLS="https://148.100.98.173:2379"
#ETCD_MAX_SNAPSHOTS="5"
#ETCD_MAX_WALS="5"
ETCD_NAME="default"
#ETCD_SNAPSHOT_COUNT="100000"
#ETCD_HEARTBEAT_INTERVAL="100"
#ETCD_ELECTION_TIMEOUT="1000"
#ETCD_QUOTA_BACKEND_BYTES="0"
#ETCD_MAX_REQUEST_BYTES="1572864"
#ETCD_GRPC_KEEPALIVE_MIN_TIME="5s"
#ETCD_GRPC_KEEPALIVE_INTERVAL="2h0m0s"
#ETCD_GRPC_KEEPALIVE_TIMEOUT="20s"
#
#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://148.100.98.173:2380"
ETCD_ADVERTISE_CLIENT_URLS="https://148.100.98.173:2379"
#ETCD_DISCOVERY=""
#ETCD_DISCOVERY_FALLBACK="proxy"
#ETCD_DISCOVERY_PROXY=""
#ETCD_DISCOVERY_SRV=""
ETCD_INITIAL_CLUSTER="default=https://148.100.98.173:2380"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster-0"
ETCD_INITIAL_CLUSTER_STATE="new"
#ETCD_STRICT_RECONFIG_CHECK="true"
#ETCD_ENABLE_V2="true"
#
#[Proxy]
#ETCD_PROXY="off"
#ETCD_PROXY_FAILURE_WAIT="5000"
#ETCD_PROXY_REFRESH_INTERVAL="30000"
#ETCD_PROXY_DIAL_TIMEOUT="1000"
#ETCD_PROXY_WRITE_TIMEOUT="5000"
#ETCD_PROXY_READ_TIMEOUT="0"
#
#[Security]
ETCD_CERT_FILE="/srv/kubernetes/etcd.crt"
ETCD_KEY_FILE="/srv/kubernetes/etcd.key"
ETCD_CLIENT_CERT_AUTH="true"
ETCD_TRUSTED_CA_FILE="/srv/kubernetes/ca.pem"
ETCD_AUTO_TLS="false"
ETCD_PEER_CERT_FILE="/srv/kubernetes/etcd.crt"
ETCD_PEER_KEY_FILE="/srv/kubernetes/etcd.key"
ETCD_PEER_CLIENT_CERT_AUTH="true"
#ETCD_PEER_TRUSTED_CA_FILE=""
ETCD_PEER_AUTO_TLS="false"
#
#[Logging]
ETCD_DEBUG="true"
ETCD_LOG_PACKAGE_LEVELS="DEBUG"
#ETCD_LOG_OUTPUT="default"
#
#[Unsafe]
#ETCD_FORCE_NEW_CLUSTER="false"
#
#[Version]
#ETCD_VERSION="false"
#ETCD_AUTO_COMPACTION_RETENTION="0"
#
#[Profiling]
#ETCD_ENABLE_PPROF="false"
#ETCD_METRICS="basic"
#
#[Auth]
#ETCD_AUTH_TOKEN="simple"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Before you start your etcd instance make sure you flush your iptables. You have to do this every time you need to start your etcd.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>iptables --flush</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start, check status of etcd</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable etcd
systemctl start etcd
systemctl status etcd</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Testing etcd</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>etcdctl --endpoints https://148.100.98.173:2379 \
  --ca-file=/srv/kubernetes/ca.pem \
  --cert-file=/srv/kubernetes/etcd.crt \
  --key-file=/srv/kubernetes/etcd.key \
  cluster-health</pre>
</div>
</div>
<div class="paragraph">
<p>Output</p>
</div>
<div class="literalblock">
<div class="content">
<pre>member ddd902eabd9d33b7 is healthy: got healthy result from http://148.100.98.173:2379
cluster is healthy</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>etcdctl --endpoints https://148.100.98.173:2379 \
  --ca-file=/srv/kubernetes/ca.pem \
  --cert-file=/srv/kubernetes/etcd.crt \
  --key-file=/srv/kubernetes/etcd.key \
  member list</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ddd902eabd9d33b7: name=default peerURLs=http://148.100.98.173:2380 clientURLs=http://148.100.98.173:2379 isLeader=true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker">Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need not install <strong>Docker CE</strong> because it is present in /usr/local/bin folder. But this docker does have a service file related to it.
So remove the existing service file and create a new one.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>rm -rf /usr/lib/systemd/system/docker*</pre>
</div>
</div>
<div class="paragraph">
<p>Make an empty file in <strong>/etc/sysconfig/</strong> with name <strong>docker</strong> so later you can add the docker configuration options.</p>
</div>
<div class="paragraph">
<p>Now create both of the following files in the /etc/systemd/system/ folder.</p>
</div>
<div class="paragraph">
<p><strong>docker.service</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Unit]
Description=Docker Application Container Engine
Documentation=http://docs.docker.com
After=network.target docker.socket
Requires=docker.socket

[Service]
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
EnvironmentFile=/etc/sysconfig/docker
PIDFile=/var/run/docker.pid
ExecStart=/usr/local/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375 -G docker
#ExecStart=/usr/local/bin/dockerd -H --storage-driver=devicemapper fd:// $DOCKER_OPTS
MountFlags=slave
LimitNOFILE=1048576
LimitNPROC=1048576
LimitCORE=infinity
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="paragraph">
<p><strong>docker.socket</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Unit]
Description=Docker Socket for the API
PartOf=docker.service

[Socket]
ListenStream=/var/run/docker.sock
SocketMode=0660
# A Socket(User|Group) replacement workaround for systemd &lt;= 214
ExecStartPost=/usr/bin/chown root:docker /var/run/docker.sock</pre>
</div>
</div>
<div class="paragraph">
<p>Reload configuration, remove the previous symbolic links, form new ones</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl daemon-reload &amp;&amp; systemctl disable docker.service &amp;&amp; systemctl enable docker.service</pre>
</div>
</div>
<div class="paragraph">
<p>Run these two below commands so that a non-root user will be able to use docker.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>groupadd docker</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>usermod -aG docker linux1</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Command for getting docker started</strong><br></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl start docker</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_flannel">Flannel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flannel is networking overlay layer designed for kubernetes but it is also used as a general purpose SDN.
Flannel does this by creating a flat network over the entire cluster which runs above the host network overlay network. So it has to be installed on all the nodes.
So by this overlay network each container gets an IP and this makes the container to container communication easy. If two containers are on the same machine then
they can use the docker bridge otherwise they use the encaptulation and UDP in order to communicate with each other.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -# -L -o /usr/bin/flanneld https://github.com/coreos/flannel/releases/download/v0.10.0/flanneld-s390x
chmod +x /usr/bin/flanneld</pre>
</div>
</div>
<div class="paragraph">
<p>Flannel does use etcd for mapping subnet to host. So by running the below command etcd will know that flannel will use it&#8217;s service.
Do this on the master node only as etcd is running on the master.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>etcdctl --endpoints https://148.100.98.173:2379 --cert-file /srv/kubernetes/etcd.crt --key-file /srv/kubernetes/etcd.key --ca-file /srv/kubernetes/ca.pem set /coreos.com/network/config '{ "Network": "100.64.0.0/16", "SubnetLen": 24, "Backend": {"Type": "vxlan"} }'</pre>
</div>
</div>
<div class="paragraph">
<p>Create a flannel service file with your etcd endpoints.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/flanneld.service &lt;&lt; EOF
[Unit]
Description=Network fabric for containers
Documentation=https://github.com/coreos/flannel
After=network.target
After=network-online.target
Wants=network-online.target
After=etcd.service
Before=docker.service

[Service]
Type=notify
Restart=always
RestartSec=5
ExecStart= /usr/bin/flanneld \\
  -etcd-endpoints=https://148.100.98.173:2379 \\
  -ip-masq=true \\
  -subnet-file=/var/lib/flanneld/subnet.env \\
  -etcd-cafile=/srv/kubernetes/ca.pem \\
  -etcd-certfile=/srv/kubernetes/etcd.crt \\
  -etcd-keyfile=/srv/kubernetes/etcd.key

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start, check status flanneld</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable flanneld
systemctl start flanneld
systemctl status flanneld</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If flannel bridge has been established then you should be able to ping one flannel node from another but before you do that flush your iptables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Do add the below line  by substituting the values of bip and mtu to the docker execstart of docker service. You can get the values of bip and mtu in the env file of flanneld located
in /var/lib/flanneld. The value of bip is that of FLANNEL_SUBNET and the value of mtu is that of FLANNEL_MTU.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>--bip= --mtu= --iptables=false --ip-masq=false --ip-forward=true"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ip link del docker0</pre>
</div>
</div>
<div class="paragraph">
<p>After adding the above line reload the docker daemon and restart it.</p>
</div>
<div class="paragraph">
<p><strong>Kube-apiserver</strong></p>
</div>
<div class="paragraph">
<p><strong>Setting up kube-apiserver as systemd service</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes
After=network.target etcd.service flanneld.service

[Service]
EnvironmentFile=-/var/lib/flanneld/subnet.env
ExecStart=/usr/bin/kube-apiserver \\
 --bind-address=0.0.0.0 \\
 --advertise-address=148.100.98.173\\
 --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,ResourceQuota \\
 --anonymous-auth=false \\
 --apiserver-count=1 \\
 --authorization-mode=Node,RBAC,AlwaysAllow \\
 --authorization-rbac-super-user=admin \\
 --etcd-cafile=/srv/kubernetes/ca.pem \\
 --etcd-certfile=/srv/kubernetes/etcd.crt \\
 --etcd-keyfile=/srv/kubernetes/etcd.key \\
 --etcd-servers=https://148.100.98.173:2379 \\
 --enable-swagger-ui=true \\
 --insecure-bind-address=0.0.0.0 \\
 --kubelet-certificate-authority=/srv/kubernetes/ca.pem \\
 --kubelet-client-certificate=/srv/kubernetes/kubelet.pem \\
 --kubelet-client-key=/srv/kubernetes/kubelet-key.pem \\
 --kubelet-https=true \\
 --client-ca-file=/srv/kubernetes/ca.pem \\
 --runtime-config=api/all=true,batch/v2alpha1=true,rbac.authorization.k8s.io/v1alpha1=true \\
 --secure-port=6443 \\
 --service-cluster-ip-range=100.65.0.0/24 \\
 --storage-backend=etcd3 \\
 --tls-cert-file=/srv/kubernetes/apiserver.pem \\
 --tls-private-key-file=/srv/kubernetes/apiserver-key.pem \\
 --tls-ca-file=/srv/kubernetes/ca.pem \\
 --logtostderr=true
Restart=on-failure
Type=notify
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start and check status of kube-apiserver</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable kube-apiserver
systemctl start kube-apiserver
systemctl status kube-apiserver</pre>
</div>
</div>
<div class="paragraph">
<p>Run the following command to check the kubectl version and it also ensures that the server has been connected it you see the server version.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl version</pre>
</div>
</div>
<div class="paragraph">
<p>Output</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Client Version: version.Info{Major:"1", Minor:"9", GitVersion:"v1.9.8", GitCommit:"c138b85178156011dc934c2c9f4837476876fb07", GitTreeState:"clean", BuildDate:"2018-05-21T19:01:12Z", GoVersion:"go1.9.3", Compiler:"gc", Platform:"linux/s390x"}
Server Version: version.Info{Major:"1", Minor:"9", GitVersion:"v1.9.8", GitCommit:"c138b85178156011dc934c2c9f4837476876fb07", GitTreeState:"clean", BuildDate:"2018-05-21T18:53:18Z", GoVersion:"go1.9.3", Compiler:"gc", Platform:"linux/s390x"}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting up Kube-scheduler</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/kube-scheduler.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes

[Service]
ExecStart=/usr/bin/kube-scheduler \\
  --leader-elect=true \\
  --kubeconfig=/var/lib/kube-scheduler/kubeconfig \\
  --master=https://148.100.98.173:6443
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start and check status of kube-scheduler</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl enable kube-scheduler
sudo systemctl start kube-scheduler
sudo systemctl status kube-scheduler</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting up Kube-controller manager</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes

[Service]
ExecStart=/usr/bin/kube-controller-manager \\
      --address=0.0.0.0 \\
      --allocate-node-cidrs=true \\
      --attach-detach-reconcile-sync-period=1m0s \\
      --cluster-cidr=100.64.0.0/16 \\
      --cluster-name=k8s.virtual.local \\
      --cluster-signing-cert-file=/srv/kubernetes/ca.pem \\
      --cluster-signing-key-file=/srv/kubernetes/ca-key.pem \\
      --configure-cloud-routes=false \\
      --kubeconfig=/var/lib/kube-controller-manager/kubeconfig \\
      --leader-elect=true \\
      --master=https://148.100.98.173:6443 \\
      --root-ca-file=/srv/kubernetes/ca.pem \\
      --service-account-private-key-file=/srv/kubernetes/apiserver-key.pem \\
      --service-cluster-ip-range=100.65.0.0/24 \\
      --use-service-account-credentials=true
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start and check status of kube-controller-manager</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable kube-controller-manager
systemctl start kube-controller-manager
systemctl status kube-controller-manager</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can do a health check of the master node</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Kubectl get cs</pre>
</div>
</div>
<div class="paragraph">
<p>Output</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NAME                 STATUS    MESSAGE              ERROR
scheduler            Healthy   ok
controller-manager   Healthy   ok
etcd-0               Healthy   {"health": "true"}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>kubelet</strong></p>
</div>
<div class="paragraph">
<p>Its role is to run the pods on the worker node.</p>
</div>
<div class="paragraph">
<p><strong>Setting up Kubelet as a systemd service</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/kubernetes/kubernetes
After=docker.service
Requires=docker.service

[Service]
ExecStart=/usr/bin/kubelet \\
  --allow-privileged=true \\
  --cluster-dns=100.65.0.10 \\
  --cluster-domain=cluster.local \\
  --container-runtime=docker \\
  --kubeconfig=/var/lib/kubelet/kubelet.kubeconfig \\
  --serialize-image-pulls=false \\
  --register-node=true \\
  --tls-cert-file=/srv/kubernetes/kubelet.pem \\
  --tls-private-key-file=/srv/kubernetes/kubelet-key.pem
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start and check status of kubelet</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable kubelet
systemctl start kubelet
systemctl status kubelet</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Setting up Kube-proxy as a systemd service</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /etc/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kube Proxy
Documentation=https://github.com/kubernetes/kubernetes

[Service]
ExecStart=/usr/bin/kube-proxy \\
  --cluster-cidr=100.64.0.0/16 \\
  --kubeconfig=/var/lib/kubelet/kubelet.kubeconfig \\
  --masquerade-all=true \\
  --proxy-mode=iptables
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Commands to start and check status of kube-proxy</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable kube-proxy
systemctl start kube-proxy
systemctl status kube-proxy</pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to check whether the node has been registered or not.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get nodes</pre>
</div>
</div>
<div class="paragraph">
<p>Output</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NAME                   STATUS    ROLES     AGE       VERSION
kubeworker.novalocal   Ready     &lt;none&gt;    1d        v1.9.8</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The flags of the respective service files may get deprecated between various releases of kubernetes. If a particular component
throws an error of deprecated flag on checking the logs then please refer to the official API documentation of that particular version and modify the service file
accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now the kubernetes cluster is ready. Let&#8217;s deploy nginx app.</p>
</div>
<div class="paragraph">
<p>Run nginx</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl create deployment nginx --image=nginx</pre>
</div>
</div>
<div class="paragraph">
<p>See pod information</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get pods -o wide</pre>
</div>
</div>
<div class="paragraph">
<p>Tests to be done on the worker node</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ping &lt;POD_IP_ADDRESS&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>There should not be any packet loss</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://&lt;POD_IP_ADDRESS&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Output</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to remove the deployment</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl delete deployment nginx</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting_options">Troubleshooting options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To view the latest logs of any service use journalctl -u &lt;service_name&gt; and press <strong>shift + G</strong> to view the latest entries in the log.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://github.com/linux-on-ibm-z/docs/wiki/Building-etcd" class="bare">https://github.com/linux-on-ibm-z/docs/wiki/Building-etcd</a></p>
</li>
<li>
<p><a href="https://nixaid.com/deploying-kubernetes-cluster-from-scratch/" class="bare">https://nixaid.com/deploying-kubernetes-cluster-from-scratch/</a></p>
</li>
<li>
<p><a href="https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step/" class="bare">https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step/</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/setup/scratch/" class="bare">https://kubernetes.io/docs/setup/scratch/</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/install/linux/linux-postinstall/" class="bare">https://docs.docker.com/install/linux/linux-postinstall/</a></p>
</li>
<li>
<p><a href="https://docs.platform9.com/support/disabling-swap-kubernetes-node/" class="bare">https://docs.platform9.com/support/disabling-swap-kubernetes-node/</a></p>
</li>
<li>
<p><a href="https://serverfault.com/questions/881517/why-disable-swap-on-kubernetes" class="bare">https://serverfault.com/questions/881517/why-disable-swap-on-kubernetes</a></p>
</li>
<li>
<p><a href="https://github.com/anujajakhade/anuja/wiki/Docker-on-RHEL" class="bare">https://github.com/anujajakhade/anuja/wiki/Docker-on-RHEL</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-08-10 23:56:22 IST
</div>
</div>
</body>
</html>
