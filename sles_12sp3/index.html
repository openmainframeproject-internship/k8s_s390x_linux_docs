<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Rajula Vineet Reddy">
<title>Installing Kubernetes on LinuxOne - SUSE Linux Enterprise Server Distribution</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Installing Kubernetes on LinuxOne - SUSE Linux Enterprise Server Distribution</h1>
<div class="details">
<span id="author" class="author">Rajula Vineet Reddy</span><br>
<span id="email" class="email"><a href="mailto:rajula96reddy@gmail.com">rajula96reddy@gmail.com</a></span><br>
<span id="revnumber">version 2.0,</span>
<span id="revdate">2018-08-12</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_versions_of_all_the_components_used">Versions of all the components used</a></li>
<li><a href="#_node_setup">Node Setup</a></li>
<li><a href="#_installing_the_required_components_on_the_nodes">Installing the required components on the nodes</a>
<ul class="sectlevel2">
<li><a href="#_components_on_master_node">Components on Master node</a></li>
<li><a href="#_components_on_worker_nodes">Components on Worker node(s)</a></li>
</ul>
</li>
<li><a href="#_creating_certificates_authentication_to_enable_secure_communication_across_all_the_kubernetes_components">Creating Certificates &amp; Authentication to enable secure communication across all the Kubernetes components</a>
<ul class="sectlevel2">
<li><a href="#_generating_certificates">Generating Certificates</a></li>
<li><a href="#_generating_kubeconfig_files">Generating Kubeconfig files</a></li>
</ul>
</li>
<li><a href="#_setting_up_etcd">Setting Up Etcd</a>
<ul class="sectlevel2">
<li><a href="#_modifying_the_etcd_systemd_service_its_configuration">Modifying the Etcd systemd service &amp; its configuration</a></li>
<li><a href="#_test_etcd_cluster">Test etcd cluster</a></li>
</ul>
</li>
<li><a href="#_setting_up_flannel">Setting up Flannel</a>
<ul class="sectlevel2">
<li><a href="#_adding_an_entry_to_etcd">Adding an entry to etcd</a></li>
<li><a href="#_configure_flannel_settings">Configure Flannel Settings</a></li>
<li><a href="#_testing_flanneld">Testing flanneld</a></li>
</ul>
</li>
<li><a href="#_setting_up_kubernetes_components_on_the_nodes">Setting up Kubernetes components on the Nodes</a>
<ul class="sectlevel2">
<li><a href="#_master_components">Master Components</a></li>
<li><a href="#_worker_components">Worker Components</a></li>
</ul>
</li>
<li><a href="#_testing_the_cluster">Testing the cluster</a>
<ul class="sectlevel2">
<li><a href="#_test_if_kuberenetes_api_server_is_running">Test if Kuberenetes Api Server is Running</a></li>
<li><a href="#_test_if_all_the_components_are_healthy">Test if all the components are healthy</a></li>
<li><a href="#_test_if_the_node_is_registered">Test if the node is registered</a></li>
<li><a href="#_deploy_ngninx">Deploy ngninx</a></li>
</ul>
</li>
<li><a href="#_setting_up_kube_dns">Setting up Kube-dns</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Note:</strong> This setup documents running a two node (1 Master &amp; 1 Worker) Kubernetes Cluster
on LinuxOne cloud using LinuxOne supported linux distribution <strong>SUSE Linux Enterprise Server 12 SP3</strong>.</p>
</div>
<div class="paragraph">
<p>Also please do note that, all the lines starting with <strong>#</strong> in the code blocks
are comments and are not intended to be ran, although they are harmless when ran ;).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versions_of_all_the_components_used">Versions of all the components used</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cluster is based on <strong>docker</strong> as container run-time and the components are installed as <strong>systemd</strong> services
with <strong>flannel</strong> as the overlay networking model. The versions of each components used are as follows</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component/ Infrastructure</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinuxOne Instance flavour</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinuxONE-Medium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinuxOne Instance OS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLES12SP3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.9.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.09.1-ce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Etcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.1</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flannel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9.1</p></td>
</tr>
</tfoot>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_node_setup">Node Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This setup requires about 2 LinuxOne cloud instances. One for master and one for worker. Make sure you chose the SLES12SP3 flavour for both the
instances while provisioning. SSH into the nodes and follow the below steps in the nodes specified across each step</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the hostnames for each of the nodes using the utility <code>hostnamectl</code> as follows. Preferrably
set the hostnames as <strong>k8s-master</strong> &amp; <strong>k8s-worker</strong> respectively.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># On Master Node
hostnamectl set-hostname k8s-master
# On Worker Node
hostnamectl set-hostname k8s-worker</code></pre>
</div>
</div>
</li>
<li>
<p>Note down the IP addresses of both the nodes. In the context of this document, IP addresses of the nodes
are as follows</p>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node</th>
<th class="tableblock halign-left valign-top">IP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="red">148.100.10.15</span></p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="red">148.100.10.16</span></p></td>
</tr>
</tfoot>
</table>
</li>
<li>
<p>It is recommended to login as root on all the nodes, as we will be dealing with files and tools which require
root permissions. You can login as root from another account using <code>sudo -i</code>. If not, use <strong>sudo</strong>
before a command wherever required. Anyways, just to be safe I will include sudo where required.</p>
</li>
<li>
<p>Enable IP forward settings on all the worker node(s) so that, the containers are able to ping the internet using the following commands</p>
<div class="literalblock">
<div class="content">
<pre>sysctl -w net.ipv4.ip_forward=1
sysctl -w net.ipv4.conf.all.forwarding=1
sysctl -w net.bridge.bridge-nf-call-iptables=1</pre>
</div>
</div>
</li>
<li>
<p>Check if docker is installed and the daemon is running on both the nodes
by running the following commands.</p>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl status docker
docker version</pre>
</div>
</div>
</li>
<li>
<p>Create the below folders in order to save certificates &amp; configuration files later</p>
<div class="ulist">
<ul>
<li>
<p>On Master Node</p>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir -p /srv/kubernetes
sudo mkdir -p /var/lib/{kube-controller-manager,kube-scheduler}
sudo mkdir /var/lib/flanneld/</pre>
</div>
</div>
</li>
<li>
<p>On Worker Node(s)</p>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir -p /srv/kubernetes
sudo mkdir -p /var/lib/{kube-proxy,kubelet}
sudo mkdir /var/lib/flanneld/</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>It is recommended to run Kubernetes without using swap memory.
Disable swap space on the <strong>worker</strong> node(s), by running</p>
<div class="literalblock">
<div class="content">
<pre>sudo swapoff -a
sudo sed -i 's/.*swap/#&amp;/' /etc/fstab</pre>
</div>
</div>
</li>
<li>
<p>Copy the contents of SSH public key of the Master node in the <code>authorized_keys</code>
file on all the worker node(s). By doing this, we can <em>scp</em> files into the worker
node(s) from the master node without having to authenticate.</p>
<div class="literalblock">
<div class="content">
<pre># On the master node, check if you already have the file 'id_rsa.pub' in '.ssh/'. If not generate the key using the following steps
ssh-keygen
# Give default settings by pressing enter
cat .ssh/id_rsa.pub
#Copy the contents from the output of the above command
# On the worker node(s) paste the copied contents at the end in the file '.ssh/authorized_keys'
echo "&lt;key_copied&gt;" &gt;&gt; .ssh/authorized_keys</pre>
</div>
</div>
</li>
<li>
<p>It is recommended to login as root on all the nodes, as we will be dealing with files and tools which require
root permissions. You can login as root from another account using <code>sudo -i</code>. If not, use <strong>sudo</strong>
before a command wherever required. Anyways, just to be safe I will include sudo where required.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_the_required_components_on_the_nodes">Installing the required components on the nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We need to download all the required components such as Kubernetes packages, Etcd, Flanneld on both the nodes.
Run the following commands on the nodes specified.</p>
</div>
<div class="sect2">
<h3 id="_components_on_master_node">Components on Master node</h3>
<div class="literalblock">
<div class="content">
<pre>sudo zypper ar -fc https://download.opensuse.org/repositories/home:/mfriesenegger:/branches:/devel:/CaaSP:/Head:/ControllerNode/SLE_12_SP3/ kubernetes
sudo zypper refresh
# choose trust always <strong>'a'</strong>
sudo zypper in etcd etcdctl kubernetes-master kubernetes-client flannel</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_components_on_worker_nodes">Components on Worker node(s)</h3>
<div class="literalblock">
<div class="content">
<pre>sudo zypper ar -fc https://download.opensuse.org/repositories/home:/mfriesenegger:/branches:/devel:/CaaSP:/Head:/ControllerNode/SLE_12_SP3/ kubernetes
sudo zypper refresh
# choose trust always <strong>'a'</strong>
sudo zypper in kubernetes-node flannel</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_certificates_authentication_to_enable_secure_communication_across_all_the_kubernetes_components">Creating Certificates &amp; Authentication to enable secure communication across all the Kubernetes components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section creates all the necessary certificates and config files to enforce secure
communication. Run all the following steps on the master node. We will have to copy
some of the certs and config files generated to the worker nodes, in order to setup the
worker components.</p>
</div>
<div class="sect2">
<h3 id="_generating_certificates">Generating Certificates</h3>
<div class="sect3">
<h4 id="_ca_certificate_authority">CA - Certificate Authority</h4>
<div class="literalblock">
<div class="content">
<pre>cd /srv/kubernetes
openssl genrsa -out ca-key.pem 2048
openssl req -x509 -new -nodes -key ca-key.pem -days 10000 -out ca.pem -subj "/CN=kube-ca"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_master_node_openssl_config">Master Node OpenSSL config</h4>
<div class="literalblock">
<div class="content">
<pre>cat &gt; openssl.cnf &lt;&lt;EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name

[req_distinguished_name]

[v3_req]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = kubernetes
DNS.2 = kubernetes.default
DNS.3 = kubernetes.default.svc
DNS.4 = kubernetes.default.svc.cluster.local
IP.1 = 127.0.0.1
IP.2 = 148.100.10.15 # Master IP
IP.3 = 100.65.0.1 #Service IP
EOF</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_apiserver_certificates">Kube-apiserver certificates</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out apiserver-key.pem 2048
openssl req -new -key apiserver-key.pem -out apiserver.csr -subj "/CN=kube-apiserver" -config openssl.cnf
openssl x509 -req -in apiserver.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial \
-out apiserver.pem -days 7200 -extensions v3_req -extfile openssl.cnf</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_admin_certificates">Admin certificates</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out admin-key.pem 2048
openssl req -new -key admin-key.pem -out admin.csr -subj "/CN=admin"
openssl x509 -req -in admin.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out admin.pem -days 7200</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_controller_manager_certificates">Kube-controller-manager certificates</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-controller-manager-key.pem 2048
openssl req -new -key kube-controller-manager-key.pem -out kube-controller-manager.csr -subj "/CN=kube-controller-manager"
openssl x509 -req -in kube-controller-manager.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-controller-manager.pem -days 7200</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_scheduler_certificates">Kube-scheduler certificates</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-scheduler-key.pem 2048
openssl req -new -key kube-scheduler-key.pem -out kube-scheduler.csr -subj "/CN=kube-scheduler"
openssl x509 -req -in kube-scheduler.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-scheduler.pem -days 7200</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_worker_openssl_config">Worker OpenSSL config</h4>
<div class="literalblock">
<div class="content">
<pre>cat &gt; worker-openssl.cnf &lt;&lt; EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[v3_req]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
IP.1 = 148.100.10.16
#IP.2 If more workers are to be configured
EOF</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kubelet_certificates_for_worker_node">Kubelet certificates (for Worker node)</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kubelet-key.pem 2048
openssl req -new -key kubelet-key.pem -out kubelet.csr -subj "/CN=kubelet" -config worker-openssl.cnf
openssl x509 -req -in kubelet.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kubelet.pem -days 7200 -extensions v3_req -extfile worker-openssl.cnf</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_proxy_certificates_for_worker_node">Kube-proxy certificates (for Worker node)</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out kube-proxy-key.pem 2048
openssl req -new -key kube-proxy-key.pem -out kube-proxy.csr -subj "/CN=kube-proxy"
openssl x509 -req -in kube-proxy.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out kube-proxy.pem -days 7200</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_worker_node_certificates">Worker node certificates</h4>
<div class="paragraph">
<p>Note: <strong>k8sworker</strong> here (and also in the next few steps) refers to the hostname of the worker &amp; <strong>148.100.10.16</strong> refers to the worker node IP. Repeat the procedure after changing
the hostname and IP to configure more worker nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out k8sworker-worker-key.pem 2048
WORKER_IP=148.100.10.16 openssl req -new -key k8sworker-worker-key.pem -out k8sworker-worker.csr -subj "/CN=system:node:k8sworker" -config worker-openssl.cnf
WORKER_IP=148.100.10.16 openssl x509 -req -in k8sworker-worker.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out k8sworker-worker.pem -days 7200 -extensions v3_req -extfile worker-openssl.cnf</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etcd_openssl_config">Etcd OpenSSL config</h4>
<div class="literalblock">
<div class="content">
<pre>cat &gt; etcd-openssl.cnf &lt;&lt;EOF
[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth,serverAuth
subjectAltName = @alt_names
[alt_names]
IP.1 = 148.100.10.15
EOF</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etcd_certificates">Etcd certificates</h4>
<div class="literalblock">
<div class="content">
<pre>openssl genrsa -out etcd.key 2048
openssl req -new -key etcd.key -out etcd.csr -subj "/CN=etcd" -extensions v3_req -config etcd-openssl.cnf -sha256
openssl x509 -req -sha256 -CA ca.pem -CAkey ca-key.pem -CAcreateserial \
-in etcd.csr -out etcd.crt -extensions v3_req -extfile etcd-openssl.cnf -days 7200</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_copy_the_required_certificates_to_the_worker_node">Copy the required certificates to the Worker node</h4>
<div class="literalblock">
<div class="content">
<pre># Run the below step on the Master node
scp ca.pem etcd.crt etcd.key kubelet.pem kubelet-key.pem root@148.100.10.16:/srv/kubernetes/</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_kubeconfig_files">Generating Kubeconfig files</h3>
<div class="sect3">
<h4 id="_admin_kubeconfig">Admin Kubeconfig</h4>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.10.15:6443
kubectl config set-credentials admin --client-certificate=/srv/kubernetes/admin.pem --client-key=/srv/kubernetes/admin-key.pem --embed-certs=true --token=$TOKEN
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=admin
kubectl config use-context linux1.k8s
cat ~/.kube/config #Create config file</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_controller_manager_kubeconfig">Kube-controller-manager Kubeconfig</h4>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.10.15:6443 --kubeconfig=/var/lib/kube-controller-manager/kubeconfig
kubectl config set-credentials kube-controller-manager --client-certificate=/srv/kubernetes/kube-controller-manager.pem --client-key=/srv/kubernetes/kube-controller-manager-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/var/lib/kube-controller-manager/kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=kube-controller-manager --kubeconfig=/var/lib/kube-controller-manager/kubeconfig
kubectl config use-context linux1.k8s --kubeconfig=/var/lib/kube-controller-manager/kubeconfig</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_scheduler_kubeconfig">Kube-scheduler Kubeconfig</h4>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.10.15:6443 --kubeconfig=/var/lib/kube-scheduler/kubeconfig
kubectl config set-credentials kube-scheduler --client-certificate=/srv/kubernetes/kube-scheduler.pem --client-key=/srv/kubernetes/kube-scheduler-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/var/lib/kube-scheduler/kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=kube-scheduler --kubeconfig=/var/lib/kube-scheduler/kubeconfig
kubectl config use-context linux1.k8s --kubeconfig=/var/lib/kube-scheduler/kubeconfig</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kubelet_kubeconfig_for_each_worker_node">Kubelet Kubeconfig (for each Worker Node)</h4>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(dd if=/dev/urandom bs=128 count=1 2&gt;/dev/null | base64 | tr -d "=+/" | dd bs=32 count=1 2&gt;/dev/null)
kubectl config set-cluster linux1.k8s --certificate-authority=/srv/kubernetes/ca.pem --embed-certs=true --server=https://148.100.99.99:6443 --kubeconfig=/srv/kubernetes/k8sworker-worker.kubeconfig
kubectl config set-credentials k8sworker --client-certificate=/srv/kubernetes/k8sworker-worker.pem --client-key=/srv/kubernetes/k8sworker-worker-key.pem --embed-certs=true --token=$TOKEN --kubeconfig=/srv/kubernetes/k8sworker-worker.kubeconfig
kubectl config set-context linux1.k8s --cluster=linux1.k8s --user=k8sworker --kubeconfig=/srv/kubernetes/k8sworker-worker.kubeconfig
kubectl config use-context linux1.k8s --kubeconfig=/srv/kubernetes/k8sworker-worker.kubeconfig
scp k8sworker-worker.kubeconfig root@148.100.10.16:/srv/kubernetes/kubelet.kubeconfig</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_copy_the_required_config_files_to_the_worker_nodes">Copy the required config files to the worker node(s)</h4>
<div class="paragraph">
<p>Similar to how we copied the certificates, we need to copy the configurations to the worker node(s)</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Run the below command on the master node
scp kubelet.kubeconfig root@148.100.10.16:/var/lib/kubelet/kubeconfig
scp kube-proxy.kubeconfig root@148.100.10.16:/var/lib/kube-proxy/kubeconfig</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_etcd">Setting Up Etcd</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_modifying_the_etcd_systemd_service_its_configuration">Modifying the Etcd systemd service &amp; its configuration</h3>
<div class="paragraph">
<p>Modify the file <code>/usr/lib/systemd/system/etcd.service</code> as shown below (Red indicates the modifications to the file)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
<span class="red">Environment="ETCD_UNSUPPORTED_ARCH=s390x"</span>
EnvironmentFile=-/etc/sysconfig/etcd
User=etcd
# set GOMAXPROCS to number of processors
ExecStart=/bin/bash -c "GOMAXPROCS=$(nproc) /usr/sbin/etcd --name=\"${ETCD_NAME}\"  \
--data-dir=\"${ETCD_DATA_DIR}\" \
--listen-client-urls=\"${ETCD_LISTEN_CLIENT_URLS}\" \
<span class="red">--cert-file=\"${ETCD_CERT_FILE}\" \
--key-file=\"${ETCD_KEY_FILE}\" \
--peer-cert-file=\"${ETCD_PEER_CERT_FILE}\" \
--peer-key-file=\"${ETCD_PEER_KEY_FILE}\" \
--trusted-ca-file=\"${ETCD_TRUSTED_CA_FILE}\"  \
--peer-trusted-ca-file=\"${ETCD_TRUSTED_CA_FILE}\"  \
--peer-client-cert-auth \
--client-cert-auth \
--initial-advertise-peer-urls=\"${ETCD_INITIAL_ADVERTISE_PEER_URLS}\"  \
--listen-peer-urls=\"${ETCD_LISTEN_PEER_URLS}\" \
--advertise-client-urls=\"${ETCD_ADVERTISE_CLIENT_URLS}\"  \
--initial-cluster-token=\"${ETCD_INITIAL_CLUSTER_TOKEN}\" \
--initial-cluster=\"${ETCD_INITIAL_CLUSTER}\" \
--initial-cluster-state=\"${ETCD_INITIAL_CLUSTER_STATE}\"</span>"
Restart=on-failure
LimitNOFILE=65536
Nice=-10
IOSchedulingClass=best-effort
IOSchedulingPriority=2

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="paragraph">
<p>Also initialize the variables in the configuration file <code>/etc/sysconfig/etcd</code>
as shown below</p>
</div>
<div class="literalblock">
<div class="content">
<pre># [member]
ETCD_NAME=master
ETCD_DATA_DIR="/data/etcd"
#ETCD_WAL_DIR=""
#ETCD_SNAPSHOT_COUNT="10000"
#ETCD_HEARTBEAT_INTERVAL="100"
#ETCD_ELECTION_TIMEOUT="1000"
ETCD_LISTEN_PEER_URLS="https://148.100.10.15:2380"
# The value "http://127.0.0.1:2379" can also be used for ETCD_LISTEN_CLIENT_URLS, but it is not secure
ETCD_LISTEN_CLIENT_URLS="https://148.100.10.15:2379"
#ETCD_MAX_SNAPSHOTS="5"
#ETCD_MAX_WALS="5"
#ETCD_CORS=""
#
#[cluster]
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://148.100.10.15:2380"
# if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. "test=http://..."
ETCD_INITIAL_CLUSTER="master=https://148.100.10.15:2380"
ETCD_INITIAL_CLUSTER_STATE="new"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster-0"
ETCD_ADVERTISE_CLIENT_URLS="https://148.100.10.15:2379"
#ETCD_DISCOVERY=""
#ETCD_DISCOVERY_SRV=""
#ETCD_DISCOVERY_FALLBACK="proxy"
#ETCD_DISCOVERY_PROXY=""
#
#[proxy]
#ETCD_PROXY="off"
#ETCD_PROXY_FAILURE_WAIT="5000"
#ETCD_PROXY_REFRESH_INTERVAL="30000"
#ETCD_PROXY_DIAL_TIMEOUT="1000"
#ETCD_PROXY_WRITE_TIMEOUT="5000"
#ETCD_PROXY_READ_TIMEOUT="0"
#
#[security]
ETCD_CERT_FILE="/srv/kubernetes/etcd.crt"
ETCD_KEY_FILE="/srv/kubernetes/etcd.key"
ETCD_CLIENT_CERT_AUTH="true"
ETCD_TRUSTED_CA_FILE="/srv/kubernetes/ca.pem"
ETCD_PEER_CERT_FILE="/srv/kubernetes/etcd.crt"
ETCD_PEER_KEY_FILE="/srv/kubernetes/etcd.key"
ETCD_PEER_CLIENT_CERT_AUTH="true"
#ETCD_PEER_TRUSTED_CA_FILE=""
#
#[logging]
ETCD_DEBUG="true"
# examples for -log-package-levels etcdserver=WARNING,security=DEBUG
ETCD_LOG_PACKAGE_LEVELS="DEBUG"</pre>
</div>
</div>
<div class="paragraph">
<p>The default value of <strong>ETCD_DATA_DIR</strong> is <strong>/var/lib/etcd</strong>, there is high
chance of running out of space. In that we need to change the <strong>ETCD_DATA_DIR</strong>
variable in <code>/var/sysconfig/etcd</code> file and also the new folder need to be
given appropriate permissions for the <strong>etcd</strong> user (as the systemd file is running as etcd user)
using the command <code>chown -R etcd:etcd &lt;new_folder_path</code>&gt;.
In the above config I have assigned <code>/data/etcd</code> as the data directory. So I need to create
the directory and give owner permissions to <strong>etcd</strong> user</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p /data/etcd
chown -R etcd:etcd /data/etcd</pre>
</div>
</div>
<div class="paragraph">
<p>Also, you need to modify the <strong>working directory</strong> value to the new directory in the etcd service file which would be
<code>/usr/lib/systemd/system/etcd.service</code>.</p>
</div>
<div class="paragraph">
<p>Now, we need to flush the IP tables in order for Etcd to run without issues. It can be done by running the following command</p>
</div>
<div class="literalblock">
<div class="content">
<pre>iptables -F</pre>
</div>
</div>
<div class="paragraph">
<p>However, when we setup flannel in the next step, it will add more iptable rules required.</p>
</div>
<div class="paragraph">
<p>Now, run the following commands to start <strong>etcd</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl daemon-reload
sudo systemctl enable etcd
sudo systemctl start etcd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_etcd_cluster">Test etcd cluster</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>etcdctl --endpoints https://148.100.10.15:2379 --cert-file /srv/kubernetes/etcd.crt --key-file /srv/kubernetes/etcd.key --ca-file /srv/kubernetes/ca.pem cluster-health</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should return <strong>cluster is healthy</strong> if etcd is running correctly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_flannel">Setting up Flannel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flannel should be installed on all the nodes. Do the following steps
on all the nodes.</p>
</div>
<div class="sect2">
<h3 id="_adding_an_entry_to_etcd">Adding an entry to etcd</h3>
<div class="paragraph">
<p>This should be run only once and only on the Master node</p>
</div>
<div class="literalblock">
<div class="content">
<pre>etcdctl --endpoints https://148.100.10.15:2379 --cert-file /srv/kubernetes/etcd.crt --key-file /srv/kubernetes/etcd.key --ca-file /srv/kubernetes/ca.pem set /coreos.com/network/config '{ "Network": "100.64.0.0/16", "SubnetLen": 24, "Backend": {"Type": "vxlan"} }'</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_flannel_settings">Configure Flannel Settings</h3>
<div class="paragraph">
<p>Initialize the variables required for flanneld in the configuration
file <code>/etc/sysconfig/flanneld</code> as shown below</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Flanneld configuration options

# etcd url location.  Point this to the server where etcd runs
FLANNEL_ETCD_ENDPOINTS="https://148.100.10.15:2379"
# ETCD Prefix for the -etcd-prefix argument
FLANNEL_ETCD_KEY="/coreos.com/network"
# Any additional options that you want to pass
FLANNEL_OPTIONS="-iface=eth0 -subnet-file=/var/lib/flanneld/subnet.env \
-etcd-cafile=/srv/kubernetes/ca.pem \
-etcd-certfile=/srv/kubernetes/etcd.crt \
-etcd-keyfile=/srv/kubernetes/etcd.key \
-ip-masq=true"</pre>
</div>
</div>
<div class="paragraph">
<p>The 'iface' here should be the interface through which the nodes communicate and flannel will
be configured for this interface.</p>
</div>
<div class="paragraph">
<p>Start the flannel daemon using the following commands</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl enable flanneld
sudo systemctl start flanneld</pre>
</div>
</div>
<div class="sect3">
<h4 id="_configure_docker_settings">Configure Docker Settings</h4>
<div class="paragraph">
<p>Modify the docker configuration file <code>/etc/sysconfig/docker</code> to
add extra arguments for docker executable as follows</p>
</div>
<div class="literalblock">
<div class="content">
<pre>## Path           : System/Management
## Description    : Extra cli switches for docker daemon
## Type           : string
## Default        : ""
## ServiceRestart : docker
#
DOCKER_OPTS="--bip=100.64.98.1/24 --mtu=1450 --iptables=false --ip-masq=false --ip-forward=true"</pre>
</div>
</div>
<div class="paragraph">
<p>For the values of <em>bip</em>,<em>mtu</em> refer to the file <code>/var/lib/flannel/subnet.env</code> on each of the nodes separately.
<em>bip</em> is the value of the variable <em>FLANNEL_SUBNET</em> and <em>mtu</em> is the value of
the variable <em>FLANNEL_MTU</em> in the above file.</p>
</div>
<div class="paragraph">
<p>Then run the following commands</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl daemon-reload
sudo systemctl restart docker</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_flanneld">Testing flanneld</h3>
<div class="paragraph">
<p>Once <strong>flanneld</strong> is started and <strong>docker</strong> daemon is restarted, running <code><code>route -n</code></code> on Master node
and Worker node(s) the bridge established can be seen with the interface name as 'flannelx'. Also
the IP of the nodes on the flannel networks can be seen by running <code><code>ip a</code></code> on all the nodes. If in case
you are not able to ping any IP&#8217;s on the flannel network, try running <code>iptables -F</code> and check. By flushing
the ip tables, we will be clearing any unwanted filtering of the packets.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_kubernetes_components_on_the_nodes">Setting up Kubernetes components on the Nodes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_master_components">Master Components</h3>
<div class="paragraph">
<p>Modify the following configuration files in the directory <code>/etc/kubernetes/</code> as shown below</p>
</div>
<div class="sect3">
<h4 id="_general_system_config_etckubernetesconfig">General system config &#8594; <code>/etc/kubernetes/config</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes system config
#
# The following values are used to configure various aspects of all
# kubernetes services, including
#
#   kube-apiserver.service
#   kube-controller-manager.service
#   kubelet.service
#   kube-proxy.service
# logging to stderr means we get it in the systemd journal
KUBE_LOGTOSTDERR="--logtostderr=true"

# journal message level, 0 is debug
KUBE_LOG_LEVEL="--v=5"

# Should this cluster be allowed to run privileged docker containers
KUBE_ALLOW_PRIV="--allow-privileged=true"

# How the controller-manager, and proxy find the apiserver
KUBE_MASTER="--master=https://148.100.10.15:6443"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_api_server_config_etckubernetesapiserver">Api-server config &#8594;  <code>/etc/kubernetes/apiserver</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes system config
#
# The following values are used to configure the kube-apiserver
#

# The address on the local server to listen to.
KUBE_API_ADDRESS=""

# The port on the local server to listen on.
# KUBE_API_PORT="--port=8080"

# Port minions listen on
# KUBELET_PORT="--kubelet-port=10250"

# Comma separated list of nodes in the etcd cluster
# KUBE_ETCD_SERVERS="--etcd-servers=https://148.100.10.15:2379"

# Address range to use for services
KUBE_SERVICE_ADDRESSES="--service-cluster-ip-range=100.65.0.0/24"

# default admission control policies
KUBE_ADMISSION_CONTROL="--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota"

# Add your own!
KUBE_API_ARGS="--bind-address=0.0.0.0 \
--advertise-address=148.100.10.15 \
--anonymous-auth=false \
--apiserver-count=1 \
--authorization-mode=Node,AlwaysAllow,RBAC \
--authorization-rbac-super-user=admin \
--etcd-cafile=/srv/kubernetes/ca.pem \
--etcd-certfile=/srv/kubernetes/etcd.crt \
--etcd-keyfile=/srv/kubernetes/etcd.key \
--etcd-servers=https://148.100.10.15:2379 \
--enable-swagger-ui=false \
--event-ttl=1h \
--kubelet-certificate-authority=/srv/kubernetes/ca.pem \
--kubelet-client-certificate=/srv/kubernetes/kubelet.pem \
--kubelet-client-key=/srv/kubernetes/kubelet-key.pem \
--kubelet-https=true \
--client-ca-file=/srv/kubernetes/ca.pem \
--runtime-config=api/all=true,batch/v2alpha1=true,rbac.authorization.k8s.io/v1alpha1=true \
--service-node-port-range=30000-32767 \
--secure-port=6443 \
--storage-backend=etcd3 \
--tls-cert-file=/srv/kubernetes/apiserver.pem \
--tls-private-key-file=/srv/kubernetes/apiserver-key.pem \
--tls-ca-file=/srv/kubernetes/ca.pem"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scheduler_config_etckubernetesscheduler">Scheduler config &#8594;  <code>/etc/kubernetes/scheduler</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes scheduler config

# default config should be adequate

# Add your own!
KUBE_SCHEDULER_ARGS="--leader-elect=true \
--kubeconfig=/var/lib/kube-scheduler/kubeconfig"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controller_manager_config_etckubernetescontroller_manager">Controller_manager config &#8594;  <code>/etc/kubernetes/controller-manager</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# The following values are used to configure the kubernetes controller-manager

# defaults from config and apiserver should be adequate

# Add your own!
KUBE_CONTROLLER_MANAGER_ARGS="--allocate-node-cidrs=true \
--address=0.0.0.0 \
--attach-detach-reconcile-sync-period=1m0s \
--cluster-cidr=100.64.0.0/16 \
--cluster-name=k8s.virtual.local \
--leader-elect=true \
--root-ca-file=/srv/kubernetes/ca.pem \
--service-account-private-key-file=/srv/kubernetes/apiserver-key.pem \
--use-service-account-credentials=true \
--kubeconfig=/var/lib/kube-controller-manager/kubeconfig \
--cluster-signing-cert-file=/srv/kubernetes/ca.pem \
--cluster-signing-key-file=/srv/kubernetes/ca-key.pem \
--service-cluster-ip-range=100.65.0.0/24 \
--configure-cloud-routes=false"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start_the_master_components">Start the master components</h4>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl enable kube-apiserver
sudo systemctl start kube-apiserver
sudo systemctl enable kube-controller-manager
sudo systemctl start kube-controller-manager
sudo systemctl enable kube-scheduler
sudo systemctl start kube-scheduler</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_worker_components">Worker Components</h3>
<div class="sect3">
<h4 id="_general_system_config_etckubernetesconfig_2">General system config &#8594;  <code>/etc/kubernetes/config</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes system config
#
# The following values are used to configure various aspects of all
# kubernetes services, including
#
#   kube-apiserver.service
#   kube-controller-manager.service
#   kubelet.service
#   kube-proxy.service
# logging to stderr means we get it in the systemd journal
KUBE_LOGTOSTDERR="--logtostderr=true"

# journal message level, 0 is debug
KUBE_LOG_LEVEL="--v=2"

# Should this cluster be allowed to run privileged docker containers
KUBE_ALLOW_PRIV="--allow-privileged=true"

# How the controller-manager, and proxy find the apiserver
KUBE_MASTER="--master=https://148.100.10.15:6443"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kubelet_config_etckuberneteskubelet">Kubelet config &#8594;  <code>/etc/kubernetes/kubelet</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes kubelet (minion) config

# The address for the info server to serve on (set to 0.0.0.0 or "" for all interfaces)
KUBELET_ADDRESS="--address=148.100.10.16"

# The port for the info server to serve on
# KUBELET_PORT="--port=10250"

# You may leave this blank to use the actual hostname
KUBELET_HOSTNAME="--hostname-override=148.100.10.16"

# Add your own!
KUBELET_ARGS="--pod-manifest-path=/etc/kubernetes/manifests \
--kubeconfig=/srv/kubernetes/kubelet.kubeconfig \
--tls-cert-file=/srv/kubernetes/kubelet.pem \
--tls-private-key-file=/srv/kubernetes/kubelet-key.pem \
--cert-dir=/var/lib/kubelet \
--container-runtime=docker \
--serialize-image-pulls=false \
--register-node=true \
--cluster-dns=100.65.0.10 \
--cluster-domain=cluster.local \
--runtime-cgroups=/systemd/system.slice --kubelet-cgroups=/systemd/system.slice \
--eviction-hard=memory.available&lt;100Mi,nodefs.available&lt;10%,nodefs.inodesFree&lt;5%,imagefs.available&lt;10%,imagefs.inodesFree&lt;5% \
--docker=unix:///var/run/docker.sock \
--node-labels=kubernetes.io/role=master,node-role.kubernetes.io/master="</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kube_proxy_config_etckubernetesproxy">Kube_proxy config &#8594;  <code>/etc/kubernetes/proxy</code></h4>
<div class="literalblock">
<div class="content">
<pre>###
# kubernetes proxy config

# default config should be adequate

# Add your own!
KUBE_PROXY_ARGS="--cluster-cidr=100.64.0.0/16 \
--masquerade-all=true \
--kubeconfig=/srv/kubernetes/kubelet.kubeconfig \
--proxy-mode=iptables"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start_the_worker_components">Start the worker components</h4>
<div class="literalblock">
<div class="content">
<pre>sudo systemctl enable kubelet
sudo systemctl start kubelet
sudo systemctl enable kube-proxy
sudo systemctl start kube-proxy</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_the_cluster">Testing the cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have deployed the cluster let&#8217;s test it.</p>
</div>
<div class="sect2">
<h3 id="_test_if_kuberenetes_api_server_is_running">Test if Kuberenetes Api Server is Running</h3>
<div class="paragraph">
<p>Running <code><code>kubectl version</code></code> should return the version of both kubectl and kube-api-server</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Client Version: version.Info{Major:"1", Minor:"9", GitVersion:"v1.9.6", GitCommit:"9f8ebd171479bec0ada837d7ee641dec2f8c6dd1", GitTreeState:"clean", BuildDate:"2018-04-06T19:54:24Z", GoVersion:"go1.9.4", Compiler:"gc", Platform:"linux/s390x"}
Server Version: version.Info{Major:"1", Minor:"9", GitVersion:"v1.9.6", GitCommit:"9f8ebd171479bec0ada837d7ee641dec2f8c6dd1", GitTreeState:"clean", BuildDate:"2018-04-06T19:54:24Z", GoVersion:"go1.9.4", Compiler:"gc", Platform:"linux/s390x"}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_if_all_the_components_are_healthy">Test if all the components are healthy</h3>
<div class="paragraph">
<p>Running <code><code>kubectl get componentstatus</code></code> should return the status of all the components</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NAME                 STATUS    MESSAGE             ERROR
scheduler            Healthy   ok
controller-manager   Healthy   ok
etcd-0               Healthy   {"health":"true"}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_if_the_node_is_registered">Test if the node is registered</h3>
<div class="paragraph">
<p>Running <code><code>kubectl get nodes</code></code> should return the nodes sucessfully registered with the server and status of each node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NAME         STATUS    ROLES     AGE       VERSION
148.100.10.16   Ready     &lt;none&gt;    6d        v1.9.6</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_ngninx">Deploy ngninx</h3>
<div class="paragraph">
<p>Let&#8217;s run an Ngnix app on the cluster.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl run nginx --image=nginx --port=80
kubectl get pods -o wide
curl http://100.64.80.1 #The IP of any of the nginx pod from the above command
#You should get the nginx welcome page as the result if everything is working fine</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_kube_dns">Setting up Kube-dns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I will use the following yaml derived from the official kubernetes repository,
made some changes (which are highlighted in red). Make sure the clusterIP here
is same as what we provide as parameters to the Kubernetes components. The yaml file can be directly download
from <a href="https://github.com/rajula96reddy/LinuxOne_Kubernetes_SLES_Deployment_Documentation/blob/master/kube-dns.yaml">here</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Copyright 2016 The Kubernetes Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: kube-dns
  namespace: kube-system
  labels:
    k8s-app: kube-dns
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: Reconcile
    kubernetes.io/name: "KubeDNS"
spec:
  selector:
    k8s-app: kube-dns
  <span class="red">clusterIP: 100.65.0.10</span>
  ports:
  - name: dns
    port: 53
    protocol: UDP
  - name: dns-tcp
    port: 53
    protocol: TCP
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kube-dns
  namespace: kube-system
  labels:
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: Reconcile
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kube-dns
  namespace: kube-system
  labels:
    addonmanager.kubernetes.io/mode: EnsureExists
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: kube-dns
  namespace: kube-system
  labels:
    k8s-app: kube-dns
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: Reconcile
spec:
  # replicas: not specified here:
  # 1. In order to make Addon Manager do not reconcile this replicas parameter.
  # 2. Default is 1.
  # 3. Will be tuned in real time if DNS horizontal auto-scaling is turned on.
  strategy:
    rollingUpdate:
      maxSurge: 10%
      maxUnavailable: 0
  selector:
    matchLabels:
      k8s-app: kube-dns
  template:
    metadata:
      labels:
        k8s-app: kube-dns
      annotations:
        scheduler.alpha.kubernetes.io/critical-pod: ''
    spec:
      tolerations:
      - key: "CriticalAddonsOnly"
        operator: "Exists"
      volumes:
      - name: kube-dns-config
        configMap:
          name: kube-dns
          optional: true
      <span class="red">- hostPath:
          path: /srv/kubernetes
        name: ssl-certs-kubernetes</span>
      containers:
      - name: kubedns
        image: gcr.io/google_containers/k8s-dns-kube-dns-s390x:1.14.7
        resources:
          # TODO: Set memory limits when we've profiled the container for large
          # clusters, then set request = limit to keep this container in
          # guaranteed class. Currently, this container falls into the
          # "burstable" category so the kubelet doesn't backoff from restarting it.
          limits:
            memory: 170Mi
          requests:
            cpu: 100m
            memory: 70Mi
        livenessProbe:
          httpGet:
            path: /healthcheck/kubedns
            port: 10054
            scheme: HTTP
          initialDelaySeconds: 60
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 5
        readinessProbe:
          httpGet:
            path: /readiness
            port: 8081
            scheme: HTTP
          # we poll on pod startup for the Kubernetes master service and
          # only setup the /readiness HTTP server once that's available.
          initialDelaySeconds: 3
          timeoutSeconds: 5
        args:
        - --domain=cluster.local.
        - --dns-port=10053
        <span class="red">- --kube-master-url=https://148.100.10.15:6443
        - --config-dir=/kube-dns-config
        - --kubecfg-file=/srv/kubernetes/kubelet.kubeconfig</span>
        - --v=2
        env:
        - name: PROMETHEUS_PORT
          value: "10055"
        ports:
        - containerPort: 10053
          name: dns-local
          protocol: UDP
        - containerPort: 10053
          name: dns-tcp-local
          protocol: TCP
        - containerPort: 10055
          name: metrics
          protocol: TCP
        volumeMounts:
        - name: kube-dns-config
          mountPath: /kube-dns-config
        <span class="red">- name: ssl-certs-kubernetes
          mountPath: /srv/kubernetes
          readOnly: true</span>
      - name: dnsmasq
        image: gcr.io/google_containers/k8s-dns-dnsmasq-nanny-s390x:1.14.7
        livenessProbe:
          httpGet:
            path: /healthcheck/dnsmasq
            port: 10054
            scheme: HTTP
          initialDelaySeconds: 60
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 5
        args:
        - -v=2
        - -logtostderr
        - -configDir=/etc/k8s/dns/dnsmasq-nanny
        - -restartDnsmasq=true
        - --
        - -k
        - --cache-size=1000
        - --no-negcache
        - --log-facility=-
        - --server=/cluster.local/127.0.0.1#10053
        - --server=/in-addr.arpa/127.0.0.1#10053
        - --server=/ip6.arpa/127.0.0.1#10053
        ports:
        - containerPort: 53
          name: dns
          protocol: UDP
        - containerPort: 53
          name: dns-tcp
          protocol: TCP
        # see: https://github.com/kubernetes/kubernetes/issues/29055 for details
        resources:
          requests:
            cpu: 150m
            memory: 20Mi
        volumeMounts:
        - name: kube-dns-config
          mountPath: /etc/k8s/dns/dnsmasq-nanny
      - name: sidecar
        image: gcr.io/google_containers/k8s-dns-sidecar-s390x:1.14.7
        livenessProbe:
          httpGet:
            path: /metrics
            port: 10054
            scheme: HTTP
          initialDelaySeconds: 60
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 5
        args:
        - --v=2
        - --logtostderr
        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV
        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV
        ports:
        - containerPort: 10054
          name: metrics
          protocol: TCP
        resources:
          requests:
            memory: 20Mi
            cpu: 10m
      dnsPolicy: Default  # Don't use cluster DNS.
      serviceAccountName: kube-dns</pre>
</div>
</div>
<div class="paragraph">
<p>To deploy the kube-dns pod, save the yaml as say <code>kube-dns.yaml</code> and
run the command <code>kubectl apply -f kube-dns.yaml</code>. In a few minutes,
the pods will start running. Run the following commands to verify if
kubedns is running as intended.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl create -f https://k8s.io/examples/admin/dns/busybox.yaml
#Wait for the pod to start
kubectl exec -ti busybox -- nslookup kubernetes.default.svc.cluster.local
# This should result in returning the Kubernetes cluster IP</pre>
</div>
</div>
<div class="paragraph">
<p>If in case the 'nslookup' is throwing up an error saying can&#8217;t reach server, try stopping the <code>systemd-resolve</code> service and try.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>If any of the Kubernetes component throws up an error, check the reason for the error by observing the logs
of the service using <code><code>journalctl -fu &lt;service name&gt;</code></code></p>
</li>
<li>
<p>To debug a kubectl command, use the flag <code><code>-v=&lt;log level&gt;</code></code></p>
</li>
<li>
<p>Get logs of a pod using 'kubectl logs'</p>
</li>
<li>
<p>Exec into a pod in case you want to dabble with the service or app directly</p>
</li>
<li>
<p>Specific container 'exec' or 'logs' can be looked at by directly using the 'docker' commands and the appropriate container name or ID</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/linux-on-ibm-z/docs/wiki/Building-etcd" class="bare">https://github.com/linux-on-ibm-z/docs/wiki/Building-etcd</a></p>
</li>
<li>
<p><a href="https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step/" class="bare">https://icicimov.github.io/blog/kubernetes/Kubernetes-cluster-step-by-step/</a></p>
</li>
<li>
<p><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/2983b28f13b294c6422a5600bb6f14142f5e7a26/docs" class="bare">https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/2983b28f13b294c6422a5600bb6f14142f5e7a26/docs</a></p>
</li>
<li>
<p><a href="https://nixaid.com/deploying-kubernetes-cluster-from-scratch/" class="bare">https://nixaid.com/deploying-kubernetes-cluster-from-scratch/</a></p>
</li>
<li>
<p><a href="https://kubernetes.io" class="bare">https://kubernetes.io</a></p>
</li>
<li>
<p><a href="https://www.suse.com/documentation/sles-12/singlehtml/book_sles_docker/book_sles_docker.html" class="bare">https://www.suse.com/documentation/sles-12/singlehtml/book_sles_docker/book_sles_docker.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.0<br>
Last updated 2018-08-12 08:37:19 IST
</div>
</div>
</body>
</html>